import boto3
import json

s3 = boto3.client('s3')
bucket_name = 'ukl-34-bucket-public'  # Change to a unique name

# Create the bucket (for non-us-east-1 regions, you'd need CreateBucketConfiguration)
s3.create_bucket(Bucket=bucket_name)

# Disable Block Public Access for the bucket
s3.put_public_access_block(
    Bucket=bucket_name,
    PublicAccessBlockConfiguration={
        'BlockPublicAcls': False,
        'IgnorePublicAcls': False,
        'BlockPublicPolicy': False,
        'RestrictPublicBuckets': False
    }
)

# Enable static website hosting
s3.put_bucket_website(
    Bucket=bucket_name,
    WebsiteConfiguration={
        'IndexDocument': {'Suffix': 'index.html'},
        'ErrorDocument': {'Key': 'index.html'}
    }
)

# Set public read policy
policy = {
    "Version": "2012-10-17",
    "Statement": [{
        "Sid": "PublicReadGetObject",
        "Effect": "Allow",
        "Principal": "*",
        "Action": ["s3:GetObject"],
        "Resource": [f"arn:aws:s3:::{bucket_name}/*"]
    }]
}

# Apply bucket policy
s3.put_bucket_policy(Bucket=bucket_name, Policy=json.dumps(policy))

print(f"Public S3 bucket {bucket_name} created and configured.")